

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Plot spatiotemporal clustering results for effect of continuous variable &#8212; mne-limo 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/reset-syntax.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          MNE-LIMO</a>
        <span class="navbar-text navbar-version pull-left"><b>0.0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../whats_new.html">What's new</a></li>
                <li><a href="../index.html">Examples</a></li>
                <li><a href="https://github.com/JoseAlanis/mne-stats">GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Plot spatiotemporal clustering results for effect of continuous variable</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../../_sources/limo_examples/group_level/plot_spatiotemporal_cluster.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container content-container">
  
  <div class="sphx-glr-download-link-note admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Click <a class="reference internal" href="#sphx-glr-download-limo-examples-group-level-plot-spatiotemporal-cluster-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="plot-spatiotemporal-clustering-results-for-effect-of-continuous-variable">
<span id="sphx-glr-limo-examples-group-level-plot-spatiotemporal-cluster-py"></span><h1>Plot spatiotemporal clustering results for effect of continuous variable<a class="headerlink" href="#plot-spatiotemporal-clustering-results-for-effect-of-continuous-variable" title="Permalink to this headline">¶</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Authors: Jose C. Garcia Alanis &lt;alanis.jcg@gmail.com&gt;</span>
<span class="c1">#</span>
<span class="c1"># License: BSD (3-clause)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="k">import</span> <span class="n">make_axes_locatable</span>

<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html#sklearn.linear_model.LinearRegression" title="View documentation for sklearn.linear_model.LinearRegression"><span class="n">LinearRegression</span></a>

<span class="kn">from</span> <span class="nn">mne.stats.cluster_level</span> <span class="k">import</span> <span class="n">_setup_connectivity</span><span class="p">,</span> <span class="n">_find_clusters</span><span class="p">,</span> \
    <span class="n">_reshape_clusters</span>
<span class="kn">from</span> <span class="nn">mne.channels</span> <span class="k">import</span> <a href="http://mne-tools.github.io/stable/generated/mne.channels.find_ch_connectivity.html#mne.channels.find_ch_connectivity" title="View documentation for mne.channels.find_ch_connectivity"><span class="n">find_ch_connectivity</span></a>
<span class="kn">from</span> <span class="nn">mne.datasets</span> <span class="k">import</span> <span class="n">limo</span>
<span class="kn">from</span> <span class="nn">mne.decoding</span> <span class="k">import</span> <a href="http://mne-tools.github.io/stable/generated/mne.decoding.Vectorizer.html#mne.decoding.Vectorizer" title="View documentation for mne.decoding.Vectorizer"><span class="n">Vectorizer</span></a><span class="p">,</span> <a href="http://mne-tools.github.io/stable/generated/mne.decoding.get_coef.html#mne.decoding.get_coef" title="View documentation for mne.decoding.get_coef"><span class="n">get_coef</span></a>
<span class="kn">from</span> <span class="nn">mne.evoked</span> <span class="k">import</span> <a href="http://mne-tools.github.io/stable/generated/mne.EvokedArray.html#mne.EvokedArray" title="View documentation for mne.evoked.EvokedArray"><span class="n">EvokedArray</span></a>
<span class="kn">from</span> <span class="nn">mne.viz</span> <span class="k">import</span> <a href="http://mne-tools.github.io/stable/generated/mne.viz.plot_topomap.html#mne.viz.plot_topomap" title="View documentation for mne.viz.plot_topomap"><span class="n">plot_topomap</span></a><span class="p">,</span> <a href="http://mne-tools.github.io/stable/generated/mne.viz.plot_compare_evokeds.html#mne.viz.plot_compare_evokeds" title="View documentation for mne.viz.plot_compare_evokeds"><span class="n">plot_compare_evokeds</span></a><span class="p">,</span> <span class="n">tight_layout</span>
<span class="kn">from</span> <span class="nn">mne</span> <span class="k">import</span> <a href="http://mne-tools.github.io/stable/generated/mne.combine_evoked.html#mne.combine_evoked" title="View documentation for mne.combine_evoked"><span class="n">combine_evoked</span></a><span class="p">,</span> <span class="n">find_layout</span>
</pre></div>
</div>
<p>Here, we’ll import multiple subjects from the LIMO-dataset and compute
group-level beta-coefficients for a continuous predictor, in addition we show
how confidence (or significance) levels can be computed for this effects
using the bootstrap-t technique and spatiotemporal clustering</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># list with subjects ids that should be imported</span>
<span class="n">subjects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">19</span><span class="p">))</span>
<span class="c1"># create a dictionary containing participants data for easy slicing</span>
<span class="n">limo_epochs</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">subj</span><span class="p">):</span> <span class="n">limo</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">subject</span><span class="o">=</span><span class="n">subj</span><span class="p">)</span> <span class="k">for</span> <span class="n">subj</span> <span class="ow">in</span> <span class="n">subjects</span><span class="p">}</span>

<span class="c1"># interpolate missing channels</span>
<span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">limo_epochs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">subject</span><span class="o">.</span><span class="n">interpolate_bads</span><span class="p">(</span><span class="n">reset_bads</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="n">subject</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">tmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmax</span><span class="o">=</span><span class="mf">0.35</span><span class="p">)</span>
    <span class="c1"># only keep eeg channels</span>
    <span class="n">subject</span><span class="o">.</span><span class="n">pick_types</span><span class="p">(</span><span class="n">eeg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>1055 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
1052 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
1072 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
1050 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
1118 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
1108 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
1060 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
1030 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
1059 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
1038 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
1029 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
943 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
1108 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
998 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
1076 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
1061 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
1098 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
1103 matching events found
No baseline correction applied
Adding metadata with 2 columns
0 projection items activated
0 bad epochs dropped
Computing interpolation matrix from 113 sensor positions
Interpolating 15 sensors
Computing interpolation matrix from 117 sensor positions
Interpolating 11 sensors
Computing interpolation matrix from 121 sensor positions
Interpolating 7 sensors
Computing interpolation matrix from 119 sensor positions
Interpolating 9 sensors
Computing interpolation matrix from 122 sensor positions
Interpolating 6 sensors
Computing interpolation matrix from 118 sensor positions
Interpolating 10 sensors
Computing interpolation matrix from 117 sensor positions
Interpolating 11 sensors
Computing interpolation matrix from 117 sensor positions
Interpolating 11 sensors
Computing interpolation matrix from 121 sensor positions
Interpolating 7 sensors
Computing interpolation matrix from 116 sensor positions
Interpolating 12 sensors
/home/josealanis/Documents/github/mne-stats/examples/group_level/plot_spatiotemporal_cluster.py:41: RuntimeWarning: No bad channels to interpolate. Doing nothing...
  subject.interpolate_bads(reset_bads=True)
Computing interpolation matrix from 115 sensor positions
Interpolating 13 sensors
Computing interpolation matrix from 122 sensor positions
Interpolating 6 sensors
Computing interpolation matrix from 114 sensor positions
Interpolating 14 sensors
Computing interpolation matrix from 117 sensor positions
Interpolating 11 sensors
Computing interpolation matrix from 125 sensor positions
Interpolating 3 sensors
Computing interpolation matrix from 126 sensor positions
Interpolating 2 sensors
Computing interpolation matrix from 122 sensor positions
Interpolating 6 sensors
</pre></div>
</div>
<p>regression parameters</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># variables to be used in the analysis (i.e., predictors)</span>
<span class="n">predictors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;intercept&#39;</span><span class="p">,</span> <span class="s1">&#39;face a - face b&#39;</span><span class="p">,</span> <span class="s1">&#39;phase-coherence&#39;</span><span class="p">]</span>

<span class="c1"># number of predictors</span>
<span class="n">n_predictors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>

<span class="c1"># save epochs information (needed for creating a homologous</span>
<span class="c1"># epochs object containing linear regression result)</span>
<span class="n">epochs_info</span> <span class="o">=</span> <span class="n">limo_epochs</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">subjects</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span><span class="o">.</span><span class="n">info</span>

<span class="c1"># number of channels and number of time points in each epoch</span>
<span class="c1"># we&#39;ll use this information later to bring the results of the</span>
<span class="c1"># the linear regression algorithm into an eeg-like format</span>
<span class="c1"># (i.e., channels x times points)</span>
<span class="n">n_channels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">epochs_info</span><span class="p">[</span><span class="s1">&#39;ch_names&#39;</span><span class="p">])</span>
<span class="n">n_times</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">limo_epochs</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">subjects</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span><span class="o">.</span><span class="n">times</span><span class="p">)</span>

<span class="c1"># also save times first time-point in data</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">limo_epochs</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">subjects</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span><span class="o">.</span><span class="n">times</span>
<span class="n">tmin</span> <span class="o">=</span> <span class="n">limo_epochs</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">subjects</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span><span class="o">.</span><span class="n">tmin</span>
</pre></div>
</div>
<p>create empty objects  for the storage of results</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># place holders for bootstrap samples</span>
<span class="n">betas</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.zeros" title="View documentation for numpy.zeros"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">limo_epochs</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
                  <span class="n">n_channels</span> <span class="o">*</span> <span class="n">n_times</span><span class="p">))</span>

<span class="c1"># dicts for results evoked-objects</span>
<span class="n">betas_evoked</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">t_evokeds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</pre></div>
</div>
<p>run regression analysis for each subject</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># loop through subjects, set up and fit linear model</span>
<span class="k">for</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">subject</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">limo_epochs</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>

    <span class="c1"># --- 1) create design matrix ---</span>
    <span class="c1"># use epochs metadata</span>
    <span class="n">design</span> <span class="o">=</span> <span class="n">subject</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># add intercept (constant) to design matrix</span>
    <span class="n">design</span> <span class="o">=</span> <span class="n">design</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">intercept</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># effect code contrast for categorical variable (i.e., condition a vs. b)</span>
    <span class="n">design</span><span class="p">[</span><span class="s1">&#39;face a - face b&#39;</span><span class="p">]</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.where" title="View documentation for numpy.where"><span class="n">np</span><span class="o">.</span><span class="n">where</span></a><span class="p">(</span><span class="n">design</span><span class="p">[</span><span class="s1">&#39;face&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># order columns of design matrix</span>
    <span class="n">design</span> <span class="o">=</span> <span class="n">design</span><span class="p">[</span><span class="n">predictors</span><span class="p">]</span>

    <span class="c1"># column of betas array (i.e., predictor) to run bootstrap on</span>
    <span class="n">pred_col</span> <span class="o">=</span> <span class="n">predictors</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;phase-coherence&#39;</span><span class="p">)</span>

    <span class="c1"># --- 2) vectorize (eeg-channel) data for linear regression analysis ---</span>
    <span class="c1"># data to be analysed</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">subject</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

    <span class="c1"># vectorize data across channels</span>
    <span class="n">Y</span> <span class="o">=</span> <a href="http://mne-tools.github.io/stable/generated/mne.decoding.Vectorizer.html#mne.decoding.Vectorizer" title="View documentation for mne.decoding.Vectorizer"><span class="n">Vectorizer</span></a><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># --- 3) fit linear model with sklearn&#39;s LinearRegression ---</span>
    <span class="c1"># we already have an intercept column in the design matrix,</span>
    <span class="c1"># thus we&#39;ll call LinearRegression with fit_intercept=False</span>
    <span class="n">linear_model</span> <span class="o">=</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html#sklearn.linear_model.LinearRegression" title="View documentation for sklearn.linear_model.LinearRegression"><span class="n">LinearRegression</span></a><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">linear_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">design</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>

    <span class="c1"># --- 4) extract the resulting coefficients (i.e., betas) ---</span>
    <span class="c1"># extract betas</span>
    <span class="n">coefs</span> <span class="o">=</span> <a href="http://mne-tools.github.io/stable/generated/mne.decoding.get_coef.html#mne.decoding.get_coef" title="View documentation for mne.decoding.get_coef"><span class="n">get_coef</span></a><span class="p">(</span><span class="n">linear_model</span><span class="p">,</span> <span class="s1">&#39;coef_&#39;</span><span class="p">)</span>
    <span class="c1"># only keep relevant predictor</span>
    <span class="n">betas</span><span class="p">[</span><span class="n">iteration</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">coefs</span><span class="p">[:,</span> <span class="n">pred_col</span><span class="p">]</span>

    <span class="c1"># the matrix of coefficients has a shape of number of observations in</span>
    <span class="c1"># the vertorized channel data by number of predictors;</span>
    <span class="c1"># thus, we can loop through the columns i.e., the predictors)</span>
    <span class="c1"># of the coefficient matrix and extract coefficients for each predictor</span>
    <span class="c1"># in order to project them back to a channels x time points space.</span>
    <span class="n">lm_betas</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="c1"># extract coefficients</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">betas</span><span class="p">[</span><span class="n">iteration</span><span class="p">,</span> <span class="p">:]</span>
    <span class="c1"># back projection to channels x time points</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">n_times</span><span class="p">))</span>
    <span class="c1"># create evoked object containing the back projected coefficients</span>
    <span class="n">lm_betas</span><span class="p">[</span><span class="s1">&#39;phase-coherence&#39;</span><span class="p">]</span> <span class="o">=</span> <a href="http://mne-tools.github.io/stable/generated/mne.EvokedArray.html#mne.EvokedArray" title="View documentation for mne.evoked.EvokedArray"><span class="n">EvokedArray</span></a><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">epochs_info</span><span class="p">,</span> <span class="n">tmin</span><span class="p">)</span>

    <span class="c1"># save results</span>
    <span class="n">betas_evoked</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">subjects</span><span class="p">[</span><span class="n">iteration</span><span class="p">])]</span> <span class="o">=</span> <span class="n">lm_betas</span>

    <span class="c1"># clean up</span>
    <span class="k">del</span> <span class="n">linear_model</span>
</pre></div>
</div>
<p>compute mean beta-coefficient for predictor phase-coherence</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># subject ids</span>
<span class="n">subjects</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">subj</span><span class="p">)</span> <span class="k">for</span> <span class="n">subj</span> <span class="ow">in</span> <span class="n">subjects</span><span class="p">]</span>

<span class="c1"># extract phase-coherence betas for each subject</span>
<span class="n">phase_coherence</span> <span class="o">=</span> <span class="p">[</span><span class="n">betas_evoked</span><span class="p">[</span><span class="n">subj</span><span class="p">][</span><span class="s1">&#39;phase-coherence&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">subj</span> <span class="ow">in</span> <span class="n">subjects</span><span class="p">]</span>

<span class="c1"># average phase-coherence betas</span>
<span class="n">weights</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.repeat" title="View documentation for numpy.repeat"><span class="n">np</span><span class="o">.</span><span class="n">repeat</span></a><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">phase_coherence</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">phase_coherence</span><span class="p">))</span>
<span class="n">ga_phase_coherence</span> <span class="o">=</span> <a href="http://mne-tools.github.io/stable/generated/mne.combine_evoked.html#mne.combine_evoked" title="View documentation for mne.combine_evoked"><span class="n">combine_evoked</span></a><span class="p">(</span><span class="n">phase_coherence</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
</pre></div>
</div>
<p>compute bootstrap confidence interval for phase-coherence betas and t-values</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># set random state for replication</span>
<span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">random</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.random.html#numpy.random.RandomState" title="View documentation for numpy.random.RandomState"><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span></a><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

<span class="c1"># number of random samples</span>
<span class="n">boot</span> <span class="o">=</span> <span class="mi">2000</span>

<span class="c1"># place holders for bootstrap samples</span>
<span class="n">cluster_H0</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.zeros" title="View documentation for numpy.zeros"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">(</span><span class="n">boot</span><span class="p">)</span>
<span class="n">f_H0</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.zeros" title="View documentation for numpy.zeros"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">(</span><span class="n">boot</span><span class="p">)</span>

<span class="c1"># setup connectivity</span>
<span class="n">n_tests</span> <span class="o">=</span> <span class="n">betas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">connectivity</span><span class="p">,</span> <span class="n">ch_names</span> <span class="o">=</span> <a href="http://mne-tools.github.io/stable/generated/mne.channels.find_ch_connectivity.html#mne.channels.find_ch_connectivity" title="View documentation for mne.channels.find_ch_connectivity"><span class="n">find_ch_connectivity</span></a><span class="p">(</span><span class="n">epochs_info</span><span class="p">,</span> <span class="n">ch_type</span><span class="o">=</span><span class="s1">&#39;eeg&#39;</span><span class="p">)</span>
<span class="n">connectivity</span> <span class="o">=</span> <span class="n">_setup_connectivity</span><span class="p">(</span><span class="n">connectivity</span><span class="p">,</span> <span class="n">n_tests</span><span class="p">,</span> <span class="n">n_times</span><span class="p">)</span>

<span class="c1"># threshond for clustering</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">100.</span>

<span class="c1"># run bootstrap for regression coefficients</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">boot</span><span class="p">):</span>
    <span class="c1"># extract random subjects from overall sample</span>
    <span class="n">resampled_subjects</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">betas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                       <span class="n">betas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                       <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># resampled betas</span>
    <span class="n">resampled_betas</span> <span class="o">=</span> <span class="n">betas</span><span class="p">[</span><span class="n">resampled_subjects</span><span class="p">,</span> <span class="p">:]</span>

    <span class="c1"># compute standard error of bootstrap sample</span>
    <span class="n">se</span> <span class="o">=</span> <span class="n">resampled_betas</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.sqrt" title="View documentation for numpy.sqrt"><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span></a><span class="p">(</span><span class="n">resampled_betas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># center re-sampled betas around zero</span>
    <span class="k">for</span> <span class="n">subj_ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">resampled_betas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">resampled_betas</span><span class="p">[</span><span class="n">subj_ind</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">resampled_betas</span><span class="p">[</span><span class="n">subj_ind</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> \
                                       <span class="n">betas</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># compute t-values for bootstrap sample</span>
    <span class="n">t_val</span> <span class="o">=</span> <span class="n">resampled_betas</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">se</span>
    <span class="c1"># transform to f-values</span>
    <span class="n">f_vals</span> <span class="o">=</span> <span class="n">t_val</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="c1"># transpose for clustering</span>
    <span class="n">f_vals</span> <span class="o">=</span> <span class="n">f_vals</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">n_times</span><span class="p">))</span>
    <span class="n">f_vals</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.transpose" title="View documentation for numpy.transpose"><span class="n">np</span><span class="o">.</span><span class="n">transpose</span></a><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">f_vals</span> <span class="o">=</span> <span class="n">f_vals</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="c1"># compute clustering on squared t-values (i.e., f-values)</span>
    <span class="n">clusters</span><span class="p">,</span> <span class="n">cluster_stats</span> <span class="o">=</span> <span class="n">_find_clusters</span><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span>
                                             <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                                             <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">,</span>
                                             <span class="n">tail</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># save max cluster mass. Combined, the max cluster mass values from</span>
    <span class="c1"># computed on the basis of the bootstrap samples provide an approximation</span>
    <span class="c1"># of the cluster mass distribution under H0</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">clusters</span><span class="p">):</span>
        <span class="n">cluster_H0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_stats</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cluster_H0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/constants.html#numpy.nan" title="View documentation for numpy.nan"><span class="n">np</span><span class="o">.</span><span class="n">nan</span></a>

    <span class="c1"># save max f-value</span>
    <span class="n">f_H0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_vals</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Could not find a connectivity matrix for the data. Computing connectivity based on Delaunay triangulations.
-- number of connected vertices : 128
</pre></div>
</div>
<p>estimate t-test based on original phase coherence betas</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># estimate t-values and f-values</span>
<span class="n">se</span> <span class="o">=</span> <span class="n">betas</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.sqrt" title="View documentation for numpy.sqrt"><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span></a><span class="p">(</span><span class="n">betas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">t_vals</span> <span class="o">=</span> <span class="n">betas</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">se</span>
<span class="n">f_vals</span> <span class="o">=</span> <span class="n">t_vals</span> <span class="o">**</span> <span class="mi">2</span>

<span class="c1"># transpose for clustering</span>
<span class="n">f_vals</span> <span class="o">=</span> <span class="n">f_vals</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">n_times</span><span class="p">))</span>
<span class="n">f_vals</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.transpose" title="View documentation for numpy.transpose"><span class="n">np</span><span class="o">.</span><span class="n">transpose</span></a><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">f_vals</span> <span class="o">=</span> <span class="n">f_vals</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n_times</span> <span class="o">*</span> <span class="n">n_channels</span><span class="p">))</span>

<span class="c1"># find clusters</span>
<span class="n">clusters</span><span class="p">,</span> <span class="n">cluster_stats</span> <span class="o">=</span> <span class="n">_find_clusters</span><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span>
                                         <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                                         <span class="n">connectivity</span><span class="o">=</span><span class="n">connectivity</span><span class="p">,</span>
                                         <span class="n">tail</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>compute significance level for clusters</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># get upper CI bound from cluster mass H0</span>
<span class="n">clust_threshold</span> <span class="o">=</span> <a href="https://www.numpy.org/devdocs/reference/generated/numpy.quantile.html#numpy.quantile" title="View documentation for numpy.quantile"><span class="n">np</span><span class="o">.</span><span class="n">quantile</span></a><span class="p">(</span><span class="n">cluster_H0</span><span class="p">[</span><span class="o">~</span><a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.isnan" title="View documentation for numpy.isnan"><span class="n">np</span><span class="o">.</span><span class="n">isnan</span></a><span class="p">(</span><span class="n">cluster_H0</span><span class="p">)],</span> <span class="p">[</span><span class="o">.</span><span class="mi">95</span><span class="p">])</span>

<span class="c1"># good cluster inds</span>
<span class="n">good_cluster_inds</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.where" title="View documentation for numpy.where"><span class="n">np</span><span class="o">.</span><span class="n">where</span></a><span class="p">(</span><span class="n">cluster_stats</span> <span class="o">&gt;</span> <span class="n">clust_threshold</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># reshape clusters</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">_reshape_clusters</span><span class="p">(</span><span class="n">clusters</span><span class="p">,</span> <span class="p">(</span><span class="n">n_times</span><span class="p">,</span> <span class="n">n_channels</span><span class="p">))</span>
</pre></div>
</div>
<p>back projection to channels x time points</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t_vals</span> <span class="o">=</span> <span class="n">t_vals</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">n_times</span><span class="p">))</span>
<span class="n">f_vals</span> <span class="o">=</span> <span class="n">f_vals</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n_times</span><span class="p">,</span> <span class="n">n_channels</span><span class="p">))</span>
</pre></div>
</div>
<p>create evoked object containing the resulting t-values</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">group_t</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">group_t</span><span class="p">[</span><span class="s1">&#39;phase-coherence&#39;</span><span class="p">]</span> <span class="o">=</span> <a href="http://mne-tools.github.io/stable/generated/mne.EvokedArray.html#mne.EvokedArray" title="View documentation for mne.evoked.EvokedArray"><span class="n">EvokedArray</span></a><span class="p">(</span><a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.transpose" title="View documentation for numpy.transpose"><span class="n">np</span><span class="o">.</span><span class="n">transpose</span></a><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
                                         <span class="n">epochs_info</span><span class="p">,</span>
                                         <span class="n">tmin</span><span class="p">)</span>
<span class="c1"># scaled values for plot</span>
<span class="n">group_t</span><span class="p">[</span><span class="s1">&#39;phase-coherence-scaled&#39;</span><span class="p">]</span> <span class="o">=</span> <a href="http://mne-tools.github.io/stable/generated/mne.EvokedArray.html#mne.EvokedArray" title="View documentation for mne.evoked.EvokedArray"><span class="n">EvokedArray</span></a><span class="p">(</span><a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.transpose" title="View documentation for numpy.transpose"><span class="n">np</span><span class="o">.</span><span class="n">transpose</span></a><span class="p">(</span><span class="n">f_vals</span> <span class="o">*</span> <span class="mf">1e-6</span><span class="p">,</span>
                                                             <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
                                                <span class="n">epochs_info</span><span class="p">,</span>
                                                <span class="n">tmin</span><span class="p">)</span>

<span class="c1"># electrodes to plot (reverse order to be compatible whit LIMO paper)</span>
<span class="n">picks</span> <span class="o">=</span> <span class="n">group_t</span><span class="p">[</span><span class="s1">&#39;phase-coherence&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ch_names</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># plot t-values, masking non-significant time points.</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">group_t</span><span class="p">[</span><span class="s1">&#39;phase-coherence&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot_image</span><span class="p">(</span><span class="n">time_unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                                            <span class="n">picks</span><span class="o">=</span><span class="n">picks</span><span class="p">,</span>
                                            <span class="c1"># mask=sig_mask,</span>
                                            <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                                            <span class="n">unit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                            <span class="c1"># keep values scale</span>
                                            <span class="n">scalings</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">eeg</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                            <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
                                            <span class="n">clim</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">eeg</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
                                            <span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;F-value&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Group-level effect of phase-coherence&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_spatiotemporal_cluster_001.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_spatiotemporal_cluster_001.png" />
<p>visualize clusters</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># get sensor positions via layout</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">find_layout</span><span class="p">(</span><span class="n">epochs_info</span><span class="p">)</span><span class="o">.</span><span class="n">pos</span>

<span class="c1"># loop over clusters</span>
<span class="k">for</span> <span class="n">i_clu</span><span class="p">,</span> <span class="n">clu_idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">good_cluster_inds</span><span class="p">):</span>
    <span class="c1"># unpack cluster information, get unique indices</span>
    <span class="n">time_inds</span><span class="p">,</span> <span class="n">space_inds</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.squeeze" title="View documentation for numpy.squeeze"><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span></a><span class="p">(</span><span class="n">clusters</span><span class="p">[</span><span class="n">clu_idx</span><span class="p">])</span>
    <span class="n">ch_inds</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.unique" title="View documentation for numpy.unique"><span class="n">np</span><span class="o">.</span><span class="n">unique</span></a><span class="p">(</span><span class="n">space_inds</span><span class="p">)</span>
    <span class="n">time_inds</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.unique" title="View documentation for numpy.unique"><span class="n">np</span><span class="o">.</span><span class="n">unique</span></a><span class="p">(</span><span class="n">time_inds</span><span class="p">)</span>

    <span class="c1"># get topography for F stat</span>
    <span class="n">f_map</span> <span class="o">=</span> <span class="n">f_vals</span><span class="p">[</span><span class="n">time_inds</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># get signals at the sensors contributing to the cluster</span>
    <span class="n">sig_times</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="n">time_inds</span><span class="p">]</span>

    <span class="c1"># create spatial mask</span>
    <span class="n">mask</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.zeros" title="View documentation for numpy.zeros"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">((</span><span class="n">f_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">mask</span><span class="p">[</span><span class="n">ch_inds</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># initialize figure</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax_topo</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="c1"># plot average test statistic and mark significant sensors</span>
    <span class="n">image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <a href="http://mne-tools.github.io/stable/generated/mne.viz.plot_topomap.html#mne.viz.plot_topomap" title="View documentation for mne.viz.plot_topomap"><span class="n">plot_topomap</span></a><span class="p">(</span><span class="n">f_map</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">ax_topo</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span>
                            <span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># create additional axes (for ERF and colorbar)</span>
    <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax_topo</span><span class="p">)</span>

    <span class="c1"># add axes for colorbar</span>
    <span class="n">ax_colorbar</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">ax_colorbar</span><span class="p">)</span>
    <span class="n">ax_topo</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span>
        <span class="s1">&#39;Averaged F-map (</span><span class="si">{:0.3f}</span><span class="s1"> - </span><span class="si">{:0.3f}</span><span class="s1"> s)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">sig_times</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]))</span>

    <span class="c1"># add new axis for time courses and plot time courses</span>
    <span class="n">ax_signals</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;300%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Cluster #</span><span class="si">{0}</span><span class="s1">, </span><span class="si">{1}</span><span class="s1"> sensor&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i_clu</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ch_inds</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ch_inds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">+=</span> <span class="s2">&quot;s (mean)&quot;</span>

    <a href="http://mne-tools.github.io/stable/generated/mne.viz.plot_compare_evokeds.html#mne.viz.plot_compare_evokeds" title="View documentation for mne.viz.plot_compare_evokeds"><span class="n">plot_compare_evokeds</span></a><span class="p">(</span><span class="n">group_t</span><span class="p">[</span><span class="s1">&#39;phase-coherence-scaled&#39;</span><span class="p">],</span>
                         <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                         <span class="n">picks</span><span class="o">=</span><span class="n">ch_inds</span><span class="p">,</span>
                         <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>
                         <span class="n">axes</span><span class="o">=</span><span class="n">ax_signals</span><span class="p">,</span>
                         <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">split_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">truncate_yaxis</span><span class="o">=</span><span class="s1">&#39;max_ticks&#39;</span><span class="p">)</span>

    <span class="c1"># plot temporal cluster extent</span>
    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">ax_signals</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">ax_signals</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">((</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="n">sig_times</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sig_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax_signals</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;F-value&#39;</span><span class="p">)</span>

    <span class="c1"># clean up viz</span>
    <span class="n">tight_layout</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=.</span><span class="mi">05</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img alt="../../_images/sphx_glr_plot_spatiotemporal_cluster_002.png" class="sphx-glr-multi-img first" src="../../_images/sphx_glr_plot_spatiotemporal_cluster_002.png" />
</li>
<li><img alt="../../_images/sphx_glr_plot_spatiotemporal_cluster_003.png" class="sphx-glr-multi-img first" src="../../_images/sphx_glr_plot_spatiotemporal_cluster_003.png" />
</li>
<li><img alt="../../_images/sphx_glr_plot_spatiotemporal_cluster_004.png" class="sphx-glr-multi-img first" src="../../_images/sphx_glr_plot_spatiotemporal_cluster_004.png" />
</li>
</ul>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/home/josealanis/Documents/github/mne-stats/examples/group_level/plot_spatiotemporal_cluster.py:337: DeprecationWarning: truncate_yaxis=&quot;max_ticks&quot; changed to truncate_yaxis=&quot;auto&quot; in version 0.19; in version 0.20 passing &quot;max_ticks&quot; will result in an error. Please update your code accordingly.
  truncate_yaxis=&#39;max_ticks&#39;)
combining channels using &quot;mean&quot;
/home/josealanis/anaconda3/lib/python3.7/site-packages/matplotlib/figure.py:445: UserWarning: Matplotlib is currently using agg, which is a non-GUI backend, so cannot show the figure.
  % get_backend())
/home/josealanis/Documents/github/mne-stats/examples/group_level/plot_spatiotemporal_cluster.py:337: DeprecationWarning: truncate_yaxis=&quot;max_ticks&quot; changed to truncate_yaxis=&quot;auto&quot; in version 0.19; in version 0.20 passing &quot;max_ticks&quot; will result in an error. Please update your code accordingly.
  truncate_yaxis=&#39;max_ticks&#39;)
combining channels using &quot;mean&quot;
/home/josealanis/anaconda3/lib/python3.7/site-packages/matplotlib/figure.py:445: UserWarning: Matplotlib is currently using agg, which is a non-GUI backend, so cannot show the figure.
  % get_backend())
/home/josealanis/Documents/github/mne-stats/examples/group_level/plot_spatiotemporal_cluster.py:337: DeprecationWarning: truncate_yaxis=&quot;max_ticks&quot; changed to truncate_yaxis=&quot;auto&quot; in version 0.19; in version 0.20 passing &quot;max_ticks&quot; will result in an error. Please update your code accordingly.
  truncate_yaxis=&#39;max_ticks&#39;)
combining channels using &quot;mean&quot;
/home/josealanis/anaconda3/lib/python3.7/site-packages/matplotlib/figure.py:445: UserWarning: Matplotlib is currently using agg, which is a non-GUI backend, so cannot show the figure.
  % get_backend())
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  48.309 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-limo-examples-group-level-plot-spatiotemporal-cluster-py">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" download="" href="../../_downloads/217d73ba9aafc3e957cca6f8ec30dfeb/plot_spatiotemporal_cluster.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_spatiotemporal_cluster.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" download="" href="../../_downloads/61f21afe5e24190ea4742ba9a64c107c/plot_spatiotemporal_cluster.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_spatiotemporal_cluster.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


</div>

<!-- Github "fork me" ribbon -->
<!--<a href="https://github.com/autoreject/autoreject"><img style="position: absolute; top: 50px; right: 0; border: 0;" -->
<!--src="https://camo.githubusercontent.com/652c5b9acfaddf3a9c326fa6bde407b87f7be0f4/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67"-->
<!--alt="Fork me on GitHub"-->
<!--data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"></a>-->
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019, José C. García Alanis.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>